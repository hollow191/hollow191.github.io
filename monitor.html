<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>传感器监控界面</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .status-online { color: #4CAF50; font-weight: bold; }
        .status-offline { color: #F44336; font-weight: bold; }
    </style>
</head>
<body>
    <div>User UUID: <span id="user-uuid">1CDBD4-C557-C81BB1</span></div>
    <div>Device: <span id="device">ESP32C3-82989</span></div>
    <div>Temperature: <span id="temperature">28.88°C (阈值30.00°C)</span></div>
    <div>Humidity: <span id="humidity">26.09% (阈值70.00%)</span></div>
    <div>WiFi Signal: <span id="wifi-signal">-32 dBm</span></div>
    <div>Status: <span id="status" class="status-offline">offline</span></div>
    <div>Last Update: <span id="last-update">2026/1/13 14:43:52</span></div>

    <script>
        // 修复时间解析逻辑：适配“2026/1/13 14:43:52”格式
        function updateOnlineStatus() {
            const lastUpdateStr = document.getElementById("last-update").textContent;
            // 拆分日期和时间："2026/1/13" → 年/月/日；"14:43:52" → 时:分:秒
            const [datePart, timePart] = lastUpdateStr.split(' ');
            const [year, month, day] = datePart.split('/').map(Number);
            const [hour, minute, second] = timePart.split(':').map(Number);
            // 构建Date对象（注意：月份是0开始，所以要-1）
            const lastUpdate = new Date(year, month - 1, day, hour, minute, second);
            const now = new Date();
            const timeDiff = now - lastUpdate; // 时间差（毫秒）

            const statusEl = document.getElementById("status");
            if (timeDiff <= 60 * 1000) { // 1分钟内有更新 → online
                statusEl.textContent = "online";
                statusEl.className = "status-online";
            } else {
                statusEl.textContent = "offline";
                statusEl.className = "status-offline";
            }
        }

        // 初始化执行 + 每5秒刷新一次
        updateOnlineStatus();
        setInterval(updateOnlineStatus, 5 * 1000);
    </script>
</body>
</html>
